<?xml version="1.0"?>
<robot name="iris" xmlns:xacro="http://www.ros.org/wiki/xacro">


 <!-- Base link -->
 <link name="base_link">
   <inertial>
     <origin xyz="0 0 0" rpy="0 0 0"/>
     <mass value="1.5"/>
     <inertia ixx="0.029125" ixy="0" ixz="0"
              iyy="0.029125" iyz="0" izz="0.055225"/>
   </inertial>
   <collision name="base_link_collision">
     <origin xyz="0 0 0" rpy="0 0 0"/>
     <geometry>
       <box size="0.47 0.47 0.11"/>
     </geometry>
   </collision>
   <visual name="base_link_visual">
     <origin xyz="0 0 0" rpy="0 0 0"/>
     <geometry>
       <mesh filename="$(find drone)/meshes/iris.stl" scale="1 1 1"/>
     </geometry>
     <material name="DarkGrey"/>
   </visual>
 </link>


 <!-- IMU link -->
 <link name="imu_link">
   <inertial>
     <origin xyz="0 0 0" rpy="0 0 0"/>
     <mass value="0.015"/>
     <inertia ixx="1e-05" ixy="0" ixz="0"
              iyy="1e-05" iyz="0" izz="1e-05"/>
   </inertial>
 </link>


 <joint name="imu_joint" type="fixed">
   <parent link="base_link"/>
   <child link="imu_link"/>
   <origin xyz="0 0 0.02" rpy="0 0 0"/>
 </joint>


 <!-- Rotors -->
 <xacro:macro name="rotor" params="id x y z mesh_file">
   <link name="rotor_${id}">
     <inertial>
       <origin xyz="0 0 0" rpy="0 0 0"/>
       <mass value="0.005"/>
       <inertia ixx="9.75e-07" ixy="0" ixz="0"
                iyy="0.000273104" iyz="0" izz="0.000274004"/>
     </inertial>
     <collision name="rotor_${id}_collision">
       <origin xyz="0 0 0" rpy="0 0 0"/>
       <geometry>
         <cylinder length="0.005" radius="0.128"/>
       </geometry>
     </collision>
     <visual name="rotor_${id}_visual">
       <origin xyz="0 0 0" rpy="0 0 0"/>
       <geometry>
         <mesh filename="$(find drone)/meshes/${mesh_file}" scale="1 1 1"/>
       </geometry>
     </visual>
   </link>


   <joint name="rotor_${id}_joint" type="continuous">
     <parent link="base_link"/>
     <child link="rotor_${id}"/>
     <origin xyz="${x} ${y} ${z}" rpy="0 0 0"/>
     <axis xyz="0 0 1"/>
   </joint>
 </xacro:macro>


 <!-- Instantiate the 4 rotors -->
 <xacro:rotor id="0" x="0.13" y="-0.22" z="0.023" mesh_file="iris_prop_ccw.dae"/>
 <xacro:rotor id="1" x="-0.13" y="0.2" z="0.023" mesh_file="iris_prop_ccw.dae"/>
 <xacro:rotor id="2" x="0.13" y="0.22" z="0.023" mesh_file="iris_prop_cw.dae"/>
 <xacro:rotor id="3" x="-0.13" y="-0.2" z="0.023" mesh_file="iris_prop_cw.dae"/>


 <!-- IMU Sensor -->
 <gazebo reference="base_link">
   <sensor type="imu" name="imu_sensor">
     <always_on>true</always_on>
     <update_rate>1000</update_rate>
     <plugin name="gazebo_ros_imu" filename="libgazebo_ros_imu.so">
       <robotNamespace>/custom_iris</robotNamespace>
       <frameName>base_link</frameName>
     </plugin>
   </sensor>
 </gazebo>


 <!-- PX4 Gazebo Interface Plugin -->
 <gazebo>
   <plugin name="gazebo_mavlink_interface" filename="libgazebo_mavlink_interface.so">
     <robot_namespace>/custom_iris</robot_namespace>
     <motor_velocity_reference>rotor_speed</motor_velocity_reference>
     <imu>
       <link_name>base_link</link_name>
       <sensor_name>imu_sensor</sensor_name>
     </imu>
   </plugin>
 </gazebo>




</robot>

